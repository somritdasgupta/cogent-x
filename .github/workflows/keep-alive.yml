name: Keep Backend Alive

on:
    schedule:
        # Run every 5 minutes
        - cron: "*/5 * * * *"
    workflow_dispatch: # Allow manual trigger

jobs:
    ping:
        runs-on: ubuntu-latest
        steps:
            - name: Ping Backend
              run: |
                  echo "🔔 Pinging backend to keep it alive..."
                  response=$(curl -s -o /dev/null -w "%{http_code}" https://cogent-x.onrender.com/)
                  echo "📡 Response code: $response"

                  if [ $response -eq 200 ]; then
                    echo "✅ Backend is alive!"
                  else
                    echo "⚠️ Backend returned status: $response"
                    exit 1
                  fi

            - name: Ping Health Endpoint
              run: |
                  echo "🏥 Checking health endpoint..."
                  response=$(curl -s -o /dev/null -w "%{http_code}" https://cogent-x.onrender.com/api/v1/health)
                  echo "📡 Health response: $response"

                  if [ $response -eq 200 ]; then
                    echo "✅ Health check passed!"
                  else
                    echo "⚠️ Health check returned: $response"
                  fi
